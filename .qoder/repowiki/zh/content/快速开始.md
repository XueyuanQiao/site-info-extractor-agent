# 快速开始

<cite>
**本文引用的文件**
- [README.md](file://README.md)
- [pyproject.toml](file://pyproject.toml)
- [requirements.txt](file://requirements.txt)
- [.env.example](file://.env.example)
- [src/main.py](file://src/main.py)
- [src/config/settings.py](file://src/config/settings.py)
- [src/agents/extractor_agent.py](file://src/agents/extractor_agent.py)
- [src/tools/browser_tool.py](file://src/tools/browser_tool.py)
- [src/prompts/system_prompt.md](file://src/prompts/system_prompt.md)
- [src/demo.py](file://src/demo.py)
- [tests/test_agent.py](file://tests/test_agent.py)
- [conftest.py](file://conftest.py)
</cite>

## 更新摘要
**变更内容**
- 强调 Playwright 浏览器安装步骤的重要性
- 更新环境变量配置说明，反映新的多提供商支持
- 新增详细的 API Key 获取指南
- 更新项目结构说明，反映实际的模块组织
- 增强故障排除指南，涵盖新功能相关的常见问题

## 目录
1. [简介](#简介)
2. [环境要求](#环境要求)
3. [安装步骤](#安装步骤)
4. [Playwright 浏览器安装](#playwright-浏览器安装)
5. [环境变量配置](#环境变量配置)
6. [API Key 获取指南](#api-key-获取指南)
7. [运行项目](#运行项目)
8. [项目结构概览](#项目结构概览)
9. [核心组件详解](#核心组件详解)
10. [多提供商支持](#多提供商支持)
11. [故障排除指南](#故障排除指南)
12. [测试与验证](#测试与验证)

## 简介
本指南面向新手开发者，帮助你在约 15 分钟内完成 Site Info Extractor Agent 的完整部署。该项目基于 LangChain 和 LangGraph 构建，支持多种 LLM 提供商（Google Gemini、OpenAI、Anthropic、Groq、SiliconFlow、讯飞、Cerebras），通过 Playwright 浏览器工具抓取网页内容，最终以结构化 JSON 输出提取结果。

## 环境要求
- **Python 版本**：3.10 及以上（强烈推荐 3.11+）
- **操作系统**：Windows、macOS 或 Linux
- **内存**：建议至少 4GB RAM
- **网络连接**：稳定的互联网连接用于下载依赖和访问 LLM API

## 安装步骤

### 1. 创建虚拟环境
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Linux/Mac:
source venv/bin/activate

# Windows:
venv\Scripts\activate
```

### 2. 安装依赖包
```bash
# 安装项目依赖
pip install -r requirements.txt
```

### 3. 安装 Playwright 浏览器
```bash
# 安装 Chromium 浏览器
playwright install
```

**重要提示**：Playwright 浏览器安装是必需的，因为项目使用 Playwright 进行网页抓取。如果跳过此步骤，将在运行时遇到浏览器启动错误。

**章节来源**
- [README.md](file://README.md#L11-L25)
- [requirements.txt](file://requirements.txt#L1-L36)
- [pyproject.toml](file://pyproject.toml#L28-L47)

## Playwright 浏览器安装

### 安装步骤
```bash
# 安装 Playwright 及其依赖
pip install playwright
playwright install

# 验证安装
playwright install-deps
```

### 常见安装问题
- **权限问题**：在某些系统上可能需要管理员权限
- **网络问题**：如果下载失败，可以使用代理或稍后重试
- **磁盘空间不足**：Playwright 需要额外的磁盘空间存储浏览器二进制文件

### 浏览器配置
项目默认使用无头模式（headless=True），这意味着浏览器会在后台运行而不会显示图形界面。这有助于节省资源并提高性能。

**章节来源**
- [src/tools/browser_tool.py](file://src/tools/browser_tool.py#L13-L42)
- [src/config/settings.py](file://src/config/settings.py#L44-L44)

## 环境变量配置

### 1. 复制配置文件
```bash
# 复制示例配置文件
cp .env.example .env
```

### 2. 编辑 .env 文件
使用文本编辑器打开 `.env` 文件并填写以下 API 密钥：

**必需配置**：
- `GOOGLE_API_KEY`：Google Gemini API 密钥（推荐，默认使用）

**可选配置**：
- `OPENAI_API_KEY`：OpenAI API 密钥
- `ANTHROPIC_API_KEY`：Anthropic API 密钥
- `GROQ_API_KEY`：Groq API 密钥
- `SILICONFLOW_API_KEY`：SiliconFlow API 密钥（OpenAI 兼容）
- `XUNFEI_API_KEY`：讯飞星火 MaaS API 密钥（OpenAI 兼容）
- `CEREBRAS_API_KEY`：Cerebras API 密钥（OpenAI 兼容）

### 3. 配置验证
启动项目后，程序会显示当前配置表，确认所有设置正确加载。

**安全注意事项**：
- `.env` 文件已被 `.gitignore` 保护，不会被提交到 Git 仓库
- 永远不要将包含真实 API 密钥的 `.env` 文件提交到 GitHub
- 如果意外提交了敏感文件，请立即撤销历史或使用加密工具

**章节来源**
- [README.md](file://README.md#L27-L47)
- [.env.example](file://.env.example#L1-L21)
- [src/config/settings.py](file://src/config/settings.py#L9-L56)

## API Key 获取指南

### Google API Key 获取步骤
1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 登录 Google 账户
3. 创建新的 API Key
4. 将 API Key 添加到 `.env` 文件的 `GOOGLE_API_KEY` 中

### OpenAI API Key 获取步骤
1. 访问 [OpenAI Platform](https://platform.openai.com/api-keys)
2. 登录 OpenAI 账户
3. 点击 "Create new secret key"
4. 复制生成的 API Key
5. 添加到 `.env` 文件的 `OPENAI_API_KEY`

### Anthropic API Key 获取步骤
1. 访问 [Anthropic Console](https://console.anthropic.com/settings/keys)
2. 登录 Anthropic 账户
3. 点击 "Create API Key"
4. 复制生成的 API Key
5. 添加到 `.env` 文件的 `ANTHROPIC_API_KEY`

### 其他提供商 API Key
对于 Groq、SiliconFlow、讯飞、Cerebras 等提供商，按照各自平台的文档创建 API Key 并添加到相应的环境变量中。

**章节来源**
- [README.md](file://README.md#L49-L54)

## 运行项目

### 方法一：使用 Python 模块运行
```bash
python -m src.main
```

### 方法二：直接运行主文件
```bash
python src/main.py
```

### 方法三：使用命令行脚本
```bash
site-extractor
```

### 交互模式操作
启动后，程序会显示当前配置，然后进入交互模式：
1. 输入网站 URL 进行提取
2. 支持多模型选择（如果配置了多个提供商）
3. 输入 `quit`、`exit` 或 `q` 退出
4. 使用 `Ctrl+C` 优雅退出

**章节来源**
- [README.md](file://README.md#L55-L59)
- [src/main.py](file://src/main.py#L230-L246)

## 项目结构概览

```
site-info-extractor-agent/
├── src/
│   ├── agents/           # Agent 实现（SiteExtractorAgent 等）
│   ├── tools/            # 工具集合（BrowserTool 等）
│   ├── prompts/          # 提示词（system prompt 等）
│   ├── config/           # 配置管理（Settings）
│   ├── demo.py           # LLM 调用示例
│   └── main.py           # 入口文件（CLI 交互）
├── tests/                # 测试文件
├── requirements.txt      # 依赖列表
├── .env.example          # 环境变量示例
└── README.md             # 项目说明
```

**章节来源**
- [README.md](file://README.md#L61-L76)

## 核心组件详解

### 配置管理系统
项目使用 Pydantic Settings 管理配置，支持：
- 环境变量自动加载
- 类型安全的配置验证
- 默认值设置
- 多提供商模型配置

### Agent 工作流
基于 LangGraph 的状态机式工作流：
- 单节点提取流程
- 异步执行支持
- 错误处理和重试机制
- 结构化结果输出

### 浏览器工具
基于 Playwright 的异步浏览器封装：
- 支持无头/有头模式
- 页面内容抓取
- 元数据提取
- 异步上下文管理

**章节来源**
- [src/config/settings.py](file://src/config/settings.py#L9-L56)
- [src/agents/extractor_agent.py](file://src/agents/extractor_agent.py#L93-L352)
- [src/tools/browser_tool.py](file://src/tools/browser_tool.py#L10-L108)

## 多提供商支持

### 支持的 LLM 提供商
项目支持以下 LLM 提供商，按优先级排序：

1. **Google Gemini**（默认，免费）
   - 模型：gemini-2.5-flash（默认）、gemini-1.5-flash、gemini-1.5-pro、gemini-pro
   - 优点：免费额度充足，响应速度快

2. **OpenAI**（付费）
   - 模型：gpt-4o-mini 等
   - 优点：质量高，支持复杂任务

3. **Anthropic**（付费）
   - 模型：claude-3-5-sonnet-20241022、claude-3-opus-20240229
   - 优点：推理能力强

4. **Groq**（付费）
   - 模型：llama-3.3-70b-versatile 等
   - 优点：速度极快

5. **SiliconFlow**（付费，OpenAI 兼容）
   - 支持多种模型
   - 优点：价格相对便宜

6. **讯飞星火**（付费，OpenAI 兼容）
   - 模型：Qwen3-1.7B 等
   - 优点：中文处理能力强

7. **Cerebras**（付费，OpenAI 兼容）
   - 模型：gpt-oss-120b
   - 优点：模型规模大

### 模型选择逻辑
程序会根据配置的 API Key 自动选择可用的提供商：
1. 检查每个提供商的 API Key
2. 按优先级顺序选择第一个可用的提供商
3. 如果没有配置任何提供商，将无法启动交互模式

**章节来源**
- [README.md](file://README.md#L87-L96)
- [src/config/settings.py](file://src/config/settings.py#L26-L42)
- [src/agents/extractor_agent.py](file://src/agents/extractor_agent.py#L119-L196)

## 故障排除指南

### 常见问题及解决方案

#### Python 版本问题
**问题**：Python 版本过低
**解决方案**：升级到 Python 3.10+，推荐 3.11+

#### 依赖安装失败
**问题**：pip 安装依赖时出现错误
**解决方案**：
1. 确保网络连接正常
2. 使用国内镜像源：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/`
3. 升级 pip：`pip install --upgrade pip`

#### Playwright 浏览器安装失败
**问题**：playwright install 命令执行失败
**解决方案**：
1. 确保网络连接正常
2. 运行 `playwright install-deps` 安装系统依赖
3. 使用管理员权限运行
4. 检查磁盘空间是否充足

#### API Key 配置错误
**问题**：程序提示未检测到 API Key
**解决方案**：
1. 确认 `.env` 文件已正确复制
2. 检查 API Key 是否正确粘贴
3. 确认 API Key 未包含多余空格
4. 重启终端使环境变量生效

#### 模型不可用（404 错误）
**问题**：出现模型未找到错误
**解决方案**：
1. 尝试其他可用的模型
2. 在相应平台启用目标模型
3. 检查 API Key 是否正确
4. 确认网络连接正常

#### 交互模式无法输入
**问题**：无法在交互模式中输入 URL
**解决方案**：
1. 确认终端支持非阻塞输入
2. 在某些 IDE 终端中可能需要调整设置
3. 尝试使用标准终端运行

#### 提取结果不是 JSON
**问题**：LLM 返回的不是结构化 JSON
**解决方案**：
1. 检查系统提示词是否正确
2. 确保 LLM 支持 JSON 输出格式
3. 调整温度参数（temperature）
4. 检查网络连接是否稳定

### 性能优化建议
- 使用无头模式（默认）以节省资源
- 合理设置 `max_tokens` 参数
- 控制并发请求数量
- 使用合适的模型以平衡质量和成本

**章节来源**
- [README.md](file://README.md#L7-L25)
- [src/main.py](file://src/main.py#L235-L240)
- [src/agents/extractor_agent.py](file://src/agents/extractor_agent.py#L326-L330)

## 测试与验证

### 运行单元测试
```bash
# 运行所有测试
pytest tests/

# 运行特定测试文件
pytest tests/test_agent.py

# 详细输出
pytest tests/test_agent.py -v
```

### 测试配置
项目使用 pytest 框架，配置位于 `conftest.py`：
- 自动添加项目根目录到 Python 路径
- 抑制兼容性警告
- 支持异步测试

### 测试覆盖范围
- BrowserTool 基础功能测试
- SiteExtractorAgent 初始化测试
- 提取功能 Mock 测试
- 异常处理测试

**章节来源**
- [tests/test_agent.py](file://tests/test_agent.py#L1-L80)
- [conftest.py](file://conftest.py#L1-L20)

## 结论

按照本指南，你可以在 15 分钟内完成 Site Info Extractor Agent 的完整部署和首次运行。项目提供了完善的多提供商支持、灵活的配置管理和强大的网页提取能力。

### 下一步建议
1. **探索不同提供商**：尝试配置多个提供商以比较性能和成本
2. **自定义提示词**：根据具体需求修改系统提示词
3. **集成到生产环境**：将提取功能集成到更大的应用中
4. **监控和日志**：添加错误监控和日志记录功能

### 常用命令速查
```bash
# 启动项目
python -m src.main

# 运行测试
pytest tests/

# 安装依赖
pip install -r requirements.txt

# 安装 Playwright
playwright install

# 查看配置
cat .env
```

祝你开发顺利！如有任何问题，请随时查看项目的 GitHub Issues 或提交新的问题反馈。